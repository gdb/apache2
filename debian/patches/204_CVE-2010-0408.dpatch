#! /bin/sh /usr/share/dpatch/dpatch-run
# Description: fix denial of service via crafted request in mod_proxy_ajp
# Origin: upstream, http://svn.apache.org/viewvc?view=revision&revision=917876

@DPATCH@
diff -urNad apache2-2.2.14~/modules/proxy/mod_proxy_ajp.c apache2-2.2.14/modules/proxy/mod_proxy_ajp.c
--- apache2-2.2.14~/modules/proxy/mod_proxy_ajp.c	2009-04-25 06:04:21.000000000 -0400
+++ apache2-2.2.14/modules/proxy/mod_proxy_ajp.c	2010-03-10 14:48:29.000000000 -0500
@@ -257,7 +257,7 @@
             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: ap_get_brigade failed");
             apr_brigade_destroy(input_brigade);
-            return HTTP_INTERNAL_SERVER_ERROR;
+            return HTTP_BAD_REQUEST;
         }
 
         /* have something */
